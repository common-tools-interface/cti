---
build:
  modules:
    - cray-cti-devel
  pkg-config:
    - common_tools_fe
    - common_tools_be
  targets:
    all:
      directory: .

test:
  parallel-jobs: 1
  modules:
    - cray-cti
  env-vars-present:
    - CTI_INSTALL_DIR
  prepend-env-vars:
    LD_LIBRARY_PATH: ${CTI_INSTALL_DIR}/lib

launch:
  args:
    # take care to use arguments that can also go in a batch script.
    # for example, use "-n4" instead of "-n 4"
    slurm: "-n4 -N2 --ntasks-per-node=2 --time=5:00"
    alps: "-n4 -N2"
  allocation:
    slurm: "-n16 -N4 -t 3:00:00"
    alps: "-l select=16:ncpus=4,place=scatter,walltime=3:00:00"
    pals: "-l select=16:ncpus=4,place=scatter,walltime=3:00:00"
meta:
  keep:
  - Makefile
  avocado-version: "100.0"

horizon:
  launch:
    allocation:
      slurm: "-n128 -N32 -t 3:00:00"
  # test:
    # parallel-jobs: 16 PE-46699

horizon-aarch:
  # test:
    # parallel-jobs: 5 PE-46699
  launch:
    allocation:
      slurm: "-n40 -N10 -t 3:00:00"

kay:
  # test:
    # parallel-jobs: 16 PE-46699
  launch:
    allocation:
      alps: "-l select=32:ncpus=4,place=scatter,walltime=3:00:00"

pea2k:
  # test:
    # parallel-jobs: 3 PE-46699
  launch:
    allocation:
      slurm: "-n24 -N6 -t 3:00:00"

pegasus:
  # test:
    # parallel-jobs: 3 PE-46699
  launch:
    environment:
      MV2_SUPPRESS_CUDA_USAGE_WARNING: 1
      MV2_SUPPRESS_JOB_STARTUP_PERFORMANCE_WARNING: 1
    allocation:
      # Multi-node MPI launches break if they include node007 or node008
      slurm: "-n24 -N6 --exclude=node007,node008 -t 3:00:00"

pinoak-login1:
  # test:
    # parallel-jobs: 5 PE-46699
  launch:
    allocation:
      slurm: "-n40 -N10 -p allnodes -t 3:00:00"

---
build:
  modules:
    - cray-cti-devel
  pkg-config:
    - common_tools_fe
    - common_tools_be
  targets:
    all:
      directory: .

test:
  parallel-jobs: 1
  modules:
    - cray-cti
  env-vars-present:
    - CTI_INSTALL_DIR
  prepend-env-vars:
    LD_LIBRARY_PATH: ${CTI_INSTALL_DIR}/lib

launch:
  args:
    slurm: "-n4 --ntasks-per-node=2 -t 5:00"
    alps: "-n4 -N2"
    ssh: "-n4 --ntasks-per-node=2"

meta:
  keep:
  - Makefile
  avocado-version: "100.0"

horizon:
  test:
    parallel-jobs: 32

horizon-aarch:
  test:
    parallel-jobs: 10
  launch:
    args:
      slurm: "-n4 --ntasks-per-node=2 -t 5:00 -p aarch"
    environment:
      SLURM_PARTITION: "aarch"

kay:
  launch:
    allocation:
      nodes: 32
  test:
    parallel-jobs: 16

pea2k:
  test:
    parallel-jobs: 5

pegasus:
  launch:
    args:
      # Multi-node MPI launches break if they include node007 or node008
      slurm: "-n4 --ntasks-per-node=2 --exclude=node007,node008 -t 5:00"
  test:
    parallel-jobs: 5

pinoak:
  test:
    parallel-jobs: 5
